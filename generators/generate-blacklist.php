<?php
const OUT_PATH = '/usr/local/turbolab.it/zzfirewall/lists/autogen/';


/**
 * Google Cloud
 * ============
 */
const GOOGLE_CLOUD_LIST_URL = 'https://www.gstatic.com/ipranges/cloud.json';
echo "⚙️ Building Google Cloud list from " . GOOGLE_CLOUD_LIST_URL . "..." . PHP_EOL;
$txtGoogleCloud = file_get_contents(GOOGLE_CLOUD_LIST_URL);

if($txtGoogleCloud === false) {
    die("⚠️ Download from " . GOOGLE_CLOUD_LIST_URL . " FAILED! Aborting!");
}

$arrGoogle = json_decode($txtGoogleCloud);

if( !is_object($arrGoogle) ) {
    die("⚠️ json_decode from " . GOOGLE_CLOUD_LIST_URL . " FAILED! Aborting!");
}

$txtGoogleCloud = "";
foreach($arrGoogle->prefixes as $oneItem) {

    if( empty($oneItem->ipv4Prefix) ) {
        continue;
    }

    $txtGoogleCloud .= $oneItem->ipv4Prefix . PHP_EOL;
}

$filePath = OUT_PATH . 'google-cloud.txt';
echo "⚙️ Writing the file to $filePath..." . PHP_EOL;
file_put_contents($filePath, $txtGoogleCloud);


/**
 * Banner
 * ======
 */
echo "⚙️ Adding banner..." . PHP_EOL;
$txtBlacklist  = '## ☠️ WARNING! This file was AUTOGENERATED by zzfirewall - Do not edit directly!';
$txtBlacklist .= PHP_EOL . '## See: https://github.com/TurboLabIt/zzfirewall/';


// add any other blacklist item here


/**
 * Writing the file...
 * ===================
 */
$filePath = OUT_PATH . 'blacklist.txt';
echo "⚙️ Writing the file to $filePath..." . PHP_EOL;
file_put_contents($filePath, $txtBlacklist);

echo PHP_EOL . "✅ " .basename(__FILE__, '.php') . " is DONE" . PHP_EOL;
